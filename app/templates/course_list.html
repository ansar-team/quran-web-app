{% extends "base.html" %}

{% block title %}My Courses{% endblock %}

{% block content %}
<div class="header">
    <h1>ğŸ“š {{ i18n.courses.title }}</h1>
    <p>{{ i18n.courses.description }}</p>
</div>

<a href="/courses/create" class="btn" style="background: #28a745;">
    â• {{ i18n.courses.btn_create }}
</a>

<div id="courses-list">
    <div id="loading" style="text-align: center; padding: 40px;">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        <p style="margin-top: 16px;">{{ i18n.courses.loading }}...</p>
    </div>
    <div id="empty-card" class="empty-state">
        <div class="empty-icon">ğŸ“š</div>
        <h3>{{ i18n.courses.e_title }}</h3>
        <p>{{ i18n.courses.e_description }}</p>
    </div>
    <div id="error-card" class="card" style="background: #f8d7da; color: #721c24; display: none">
        <p>${error.message}</p>
        <h3>{{ i18n.courses.error }}</h3>
        <p>{{ i18n.courses.hint }}</p>
    </div>
</div>

<a href="/" class="btn btn-secondary"  style="margin-bottom: 58px">â† {{ i18n.courses.btn_back }}</a>
{% endblock %}

{% block scripts %}
async function loadCourses() {
    try {
        const response = await fetch('/api/v1/courses/');

        if (!response.ok) {
            throw new Error('Failed to load courses');
        }

        const courses = await response.json();
        document.getElementById('loading').style.display = 'none';

        const coursesList = document.getElementById('courses-list');

        if (courses.length === 0) {
            document.getElementById('empty-card').style.display = "block";
        } else {
            coursesList.innerHTML = courses.map(course => `
                <div class="card" style="cursor: pointer;" onclick="location.href='/courses/${course.id}'">
                    <h3>${course.title}</h3>
                    <p style="margin: 8px 0; color: var(--tg-theme-hint-color, #666);">
                        ${course.description}
                    </p>
                    <p style="font-size: 14px; color: var(--tg-theme-hint-color, #666);">
                        ${course.native_language} â†’ ${course.language}
                    </p>
                </div>
            `).join('');

            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => {
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                });
            });
        }
    } catch (error) {
        console.error('Error loading courses:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-card').style.display = "block";
    }
}

loadCourses();
{% endblock %}
