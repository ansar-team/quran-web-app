{% extends "base.html" %}

{% block title %}Lesson Complete!{% endblock %}

{% block content %}
<div class="header">
    <h1>ðŸŽ‰ Lesson Complete!</h1>
    <p>Great job! You've mastered this lesson.</p>
</div>

<div class="card" style="background: #d4edda; border: 2px solid #28a745;">
    <h2 style="color: #155724; margin-bottom: 16px;">Excellent Progress!</h2>
    <p style="color: #155724;">
        You've successfully completed <strong id="completed-lesson-title">this lesson</strong>
    </p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number" id="words-studied">0</div>
        <div class="stat-label">Words Studied</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" id="words-learned">0</div>
        <div class="stat-label">Words Learned</div>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 12px;">ðŸŽ¯ What's Next?</h3>
    <p style="margin-bottom: 16px; color: var(--tg-theme-hint-color, #666);">
        Words you rated as "Hard" will appear more frequently in review sessions to strengthen your memory.
    </p>
</div>
<!--TODO: add functionality to those buttons -->
<a href="#" id="continue-btn" class="btn">
    Continue to Next Lesson
</a>
<a href="/lessons/{{ lesson_id }}" class="btn btn-secondary">
    Review This Lesson Again
</a>
<a href="/courses" class="btn btn-secondary">
    ðŸ“š All Courses
</a>
{% endblock %}

{% block scripts %}
const lessonId = {{ lesson_id }};

async function loadCompletionData() {
    try {
        const lessonResponse = await fetch(`/api/v1/lessons/${lessonId}`, {
            headers: createAuthHeaders()
        });

        if (!lessonResponse.ok) {
            throw new Error('Failed to load lesson');
        }

        const lesson = await lessonResponse.json();
        document.getElementById('completed-lesson-title').textContent = lesson.title;
        document.getElementById('continue-btn').href = `/courses/${lesson.course_id}`;

        // Load lesson progress to get accurate stats
        const progressResponse = await fetch(`/api/v1/reviews/progress/lesson/${lessonId}`, {
            headers: createAuthHeaders()
        });

        if (progressResponse.ok) {
            const progress = await progressResponse.json();
            document.getElementById('words-studied').textContent = progress.total_words;
            document.getElementById('words-learned').textContent = progress.words_learned;
        }
    } catch (error) {
        console.error('Error loading completion data:', error);
    }
}

// Celebrate!
tg.HapticFeedback.notificationOccurred('success');

// Load data
loadCompletionData();
{% endblock %}
