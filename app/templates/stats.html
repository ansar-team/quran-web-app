{% extends "base.html" %}

{% block title %}Your Progress{% endblock %}

{% block content %}
<div class="header">
    <h1>üìä {{ i18n.stats.title }}</h1>
    <p>{{ i18n.courses.desc }}</p>
</div>

<div id="stats-content">
    <div id="loading" style="text-align: center; padding: 40px;">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        <p style="margin-top: 16px;">{{ i18n.stats.loading }}...</p>
    </div>
    <div id="empty-card" class="empty-state" style="display: none">
        <div class="empty-icon">üìà</div>
        <h3>{{ i18n.stats.e_title }}</h3>
        <p>{{ i18n.stats.e_desc }}</p>
    </div>
    <div id="error-card" class="card" style="background: #f8d7da; color: #721c24; display: none">
        <h3>{{ i18n.stats.error }}</h3>
        <p>{{ i18n.stats.hint }}</p>
    </div>
    <div id="stats-main" style="display:none;">
        <div class="stats-grid">
            <div class="stat-card">
                <div id="total-lessons" class="stat-number">0</div>
                <div class="stat-label">{{ i18n.stats.total_lessons }}</div>
            </div>
            <div class="stat-card">
                <div id="completed-lessons" class="stat-number">0</div>
                <div class="stat-label">{{ i18n.stats.completed }}</div>
            </div>
            <div class="stat-card">
                <div id="learned-words" class="stat-number">0</div>
                <div class="stat-label">{{ i18n.stats.learned_words }}</div>
            </div>
            <div class="stat-card">
                <div id="due-review" class="stat-number">0</div>
                <div class="stat-label">{{ i18n.stats.due_for_review }}</div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 12px;">{{ i18n.stats.completion_rate }}</h3>
            <div class="progress-bar" style="height:24px;">
                <div id="completion-bar" class="progress-fill" style="display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;width:0%">
                    <span id="completion-text">0%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<a href="/" class="btn btn-secondary" style="margin-bottom: 58px">‚Üê {{ i18n.stats.btn_back }}</a>
{% endblock %}

{% block scripts %}
async function loadStats() {
    try {
        const response = await fetch('/api/v1/users/progress');

        if (!response.ok) {
            throw new Error('Failed to load stats');
        }

        const stats = await response.json();
        document.getElementById('loading').style.display = 'none';

        const statsContent = document.getElementById('stats-content');

        if (stats.total_words === 0) {
            document.getElementById('empty-card').style.display = 'block';
            return;
        }

        document.getElementById('stats-main').style.display = 'block';

        document.getElementById('total-lessons').textContent = stats.total_lessons || 0;
        document.getElementById('completed-lessons').textContent = stats.completed_lessons || 0;
        document.getElementById('learned-words').textContent = stats.total_words || 0;
        document.getElementById('due-review').textContent = stats.words_due_for_review || 0;

        const rate = stats.total_lessons
            ? Math.round(stats.completed_lessons / stats.total_lessons * 100)
            : 0;

        document.getElementById('completion-bar').style.width = rate + '%';
        document.getElementById('completion-text').textContent = rate + '%';
    } catch (error) {
        console.error('Error loading stats:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-card').style.display = "block";
    }
}

// Load stats on page load
loadStats();
{% endblock %}
