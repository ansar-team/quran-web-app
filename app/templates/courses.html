{% extends "base.html" %}

{% block title %}My Courses{% endblock %}

{% block content %}
<div class="header">
    <h1>📚 My Courses</h1>
    <p>Select a course to continue learning</p>
</div>

<div id="courses-list">
    <div style="text-align: center; padding: 40px;">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        <p style="margin-top: 16px;">Loading courses...</p>
    </div>
</div>

<a href="/" class="btn btn-secondary">← Back to Home</a>
{% endblock %}

{% block scripts %}
// Load courses via API
async function loadCourses() {
    try {
        const headers = createAuthHeaders()
        const response = await fetch('/api/v1/courses/', {
            headers: headers,
        });

        if (!response.ok) {
            throw new Error(`Failed to load courses. Headers: ${JSON.stringify(headers)}`);
        }

        const courses = await response.json();
        const coursesList = document.getElementById('courses-list');

        if (courses.length === 0) {
            coursesList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">📚</div>
                    <h3>No courses yet</h3>
                    <p>You need to create a course through the API to start learning</p>
                </div>
            `;
        } else {
            coursesList.innerHTML = courses.map(course => `
                <div class="card" style="cursor: pointer;" onclick="location.href='/courses/${course.id}'">
                    <h3>${course.title}</h3>
                    <p style="margin: 8px 0; color: var(--tg-theme-hint-color, #666);">
                        ${course.description || 'No description'}
                    </p>
                    <p style="font-size: 14px; color: var(--tg-theme-hint-color, #666);">
                        <strong>Language:</strong> ${course.native_language} → ${course.language}
                    </p>
                </div>
            `).join('');

            // Add click feedback
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => {
                    tg.HapticFeedback.impactOccurred('light');
                });
            });
        }
    } catch (error) {
        console.error('Error loading courses:', error);
        document.getElementById('courses-list').innerHTML = `
            <div class="card" style="background: #f8d7da; color: #721c24;">
                <p>${error.message}</p>
                <h3>Error loading courses</h3>
                <p>Please make sure you're accessing from Telegram</p>
            </div>
        `;
    }
}

// Load on page load
loadCourses();
{% endblock %}
